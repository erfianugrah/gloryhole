{{template "base.html" .}}

{{define "title"}}Settings - Glory-Hole DNS{{end}}

{{define "content"}}
<div class="settings-page">
    <div class="page-header">
        <h2>Settings</h2>
    </div>

    <!-- DNS Settings -->
    <div class="settings-section">
        <h3>DNS Configuration</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>DNS Listen Address</h4>
                <p>UDP and TCP DNS server bind address</p>
            </div>
            <div class="setting-value">
                <code>:53</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Upstream DNS Servers</h4>
                <p>Servers used for forwarding queries</p>
            </div>
            <div class="setting-value">
                <code>1.1.1.1:53, 8.8.8.8:53</code>
            </div>
        </div>
    </div>

    <!-- Cache Settings -->
    <div class="settings-section">
        <h3>Cache Configuration</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Cache Size</h4>
                <p>Maximum number of cached entries</p>
            </div>
            <div class="setting-value">
                <code>10,000</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Minimum TTL</h4>
                <p>Minimum cache time for records</p>
            </div>
            <div class="setting-value">
                <code>1m</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Maximum TTL</h4>
                <p>Maximum cache time for records</p>
            </div>
            <div class="setting-value">
                <code>24h</code>
            </div>
        </div>
    </div>

    <!-- Blocklist Settings -->
    <div class="settings-section">
        <h3>Blocklist Configuration</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Auto-Update</h4>
                <p>Automatically update blocklists</p>
            </div>
            <div class="setting-value">
                <label class="toggle-switch">
                    <input type="checkbox" checked disabled>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Update Interval</h4>
                <p>How often to refresh blocklists</p>
            </div>
            <div class="setting-value">
                <code>24h</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Blocklist Sources</h4>
                <p>Active blocklist URLs</p>
            </div>
            <div class="setting-value">
                <button class="btn btn-secondary btn-sm">View Sources</button>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Manual Reload</h4>
                <p>Force reload all blocklists now</p>
            </div>
            <div class="setting-value">
                <button class="btn btn-primary btn-sm" onclick="reloadBlocklists()">Reload Now</button>
            </div>
        </div>
    </div>

    <!-- Storage Settings -->
    <div class="settings-section">
        <h3>Storage Configuration</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Backend</h4>
                <p>Query log storage backend</p>
            </div>
            <div class="setting-value">
                <code>SQLite</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Buffer Size</h4>
                <p>Queries buffered before write</p>
            </div>
            <div class="setting-value">
                <code>1,000</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Retention Period</h4>
                <p>How long to keep query logs</p>
            </div>
            <div class="setting-value">
                <code>7 days</code>
            </div>
        </div>
    </div>

    <!-- API Settings -->
    <div class="settings-section">
        <h3>API Server</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Listen Address</h4>
                <p>HTTP API and Web UI address</p>
            </div>
            <div class="setting-value">
                <code>:8080</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>CORS Enabled</h4>
                <p>Allow cross-origin requests</p>
            </div>
            <div class="setting-value">
                <label class="toggle-switch">
                    <input type="checkbox" checked disabled>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Telemetry Settings -->
    <div class="settings-section">
        <h3>Telemetry & Monitoring</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Prometheus Metrics</h4>
                <p>Enable Prometheus endpoint</p>
            </div>
            <div class="setting-value">
                <label class="toggle-switch">
                    <input type="checkbox" checked disabled>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Metrics Port</h4>
                <p>Prometheus endpoint port</p>
            </div>
            <div class="setting-value">
                <code>:9090</code>
            </div>
        </div>
    </div>

    <!-- System Info -->
    <div class="settings-section">
        <h3>System Information</h3>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Version</h4>
                <p>Glory-Hole DNS version</p>
            </div>
            <div class="setting-value">
                <code>{{.Version}}</code>
            </div>
        </div>
        <div class="setting-row">
            <div class="setting-label">
                <h4>Configuration File</h4>
                <p>Active configuration file path</p>
            </div>
            <div class="setting-value">
                <code>config.yml</code>
            </div>
        </div>
    </div>

    <div class="settings-info">
        <p><strong>Note:</strong> Most settings require a server restart to take effect. Edit <code>config.yml</code> and restart the service.</p>
        <p>For runtime changes, use the Policies page to add filtering rules.</p>
    </div>
</div>

<script>
async function reloadBlocklists() {
    const button = event.target;
    button.disabled = true;
    button.textContent = 'Reloading...';

    try {
        const response = await fetch('/api/blocklist/reload', {
            method: 'POST'
        });

        if (response.ok) {
            const result = await response.json();
            alert(`Blocklists reloaded successfully!\n${result.domains} domains loaded.`);
        } else {
            const error = await response.json();
            alert('Error: ' + (error.message || 'Failed to reload blocklists'));
        }
    } catch (error) {
        alert('Error: ' + error.message);
    } finally {
        button.disabled = false;
        button.textContent = 'Reload Now';
    }
}
</script>

<style>
.settings-info {
    background-color: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 1rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    color: #92400e;
}

.settings-info p {
    margin: 0.5rem 0;
}

.settings-info code {
    background-color: #fef3c7;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-family: 'Courier New', Courier, monospace;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}
</style>
{{end}}
