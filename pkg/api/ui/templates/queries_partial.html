<div class="table-wrapper">
    <table class="queries-table">
        <thead>
            <tr>
                <th>Time</th>
                <th>Client</th>
                <th>Domain</th>
                <th>Type</th>
                <th>Status</th>
                <th>Response Code</th>
                <th>Upstream</th>
                <th>Latency (total/upstream)</th>
                <th>Trace</th>
            </tr>
        </thead>
        <tbody>
            {{range .Queries}}
            <tr class="status-row status-{{.Status}}"
                data-timestamp="{{.Timestamp.Unix}}" data-client="{{.ClientIP}}"
                data-domain="{{.Domain}}"
                data-type="{{.QueryType}}"
                data-status="{{.Status}}"
                data-rcode="{{.ResponseCode}}"
                data-upstream="{{.Upstream}}"
                data-latency="{{printf "%.4f" .ResponseTimeMs}}"
                data-upstream-time="{{printf "%.4f" .UpstreamTimeMs}}">
                <td>{{.Timestamp.Format "15:04:05"}}</td>
                <td>{{.ClientIP}}</td>
                <td class="domain-cell">{{.Domain}}</td>
                <td>{{.QueryType}}</td>
                <td>
                    <span class="status-chip status-{{.Status}}">{{.StatusLabel}}</span>
                </td>
                <td>
                    {{if eq .ResponseCode 0}}
                    <span class="rcode-badge rcode-success" title="NOERROR - No error condition">0</span>
                    {{else if eq .ResponseCode 2}}
                    <span class="rcode-badge rcode-error" title="SERVFAIL - Server failure">2</span>
                    {{else if eq .ResponseCode 3}}
                    <span class="rcode-badge rcode-warning" title="NXDOMAIN - Non-existent domain">3</span>
                    {{else if eq .ResponseCode 5}}
                    <span class="rcode-badge rcode-error" title="REFUSED - Query refused">5</span>
                    {{else}}
                    <span class="rcode-badge" title="Response code {{.ResponseCode}}">{{.ResponseCode}}</span>
                    {{end}}
                </td>
                <td class="upstream-cell">
                    {{if .Upstream}}
                    <span class="upstream-name">{{.Upstream}}</span>
                    {{else}}
                    <span class="text-muted">--</span>
                    {{end}}
                </td>
                <td>
                    <span class="latency-total">{{printf "%.2f" .ResponseTimeMs}}</span> /
                    <span class="latency-upstream">{{printf "%.2f" .UpstreamTimeMs}}</span> ms
                </td>
                <td>
                    {{if .BlockTrace}}
                    <button class="btn btn-secondary btn-xs"
                            type="button"
                            data-trace-btn
                            data-domain="{{.Domain}}"
                            data-client="{{.ClientIP}}"
                            data-trace='{{json .BlockTrace | html}}'>
                        View
                    </button>
                    {{else}}
                    <span class="text-muted">--</span>
                    {{end}}
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="9" class="no-data">No queries yet</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<style>
/* Enhanced query table styles */
.domain-cell {
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.upstream-cell {
    max-width: 150px;
}

.upstream-name {
    font-size: 0.9em;
    color: var(--text-secondary);
}

.rcode-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 500;
    background: var(--bg-secondary);
    color: var(--text-primary);
    cursor: help;
}

.rcode-badge.rcode-success {
    background: var(--success-bg, #d4edda);
    color: var(--success-text, #155724);
}

[data-theme="dark"] .rcode-badge.rcode-success {
    background: rgba(40, 167, 69, 0.2);
    color: #95ea81;
}

.rcode-badge.rcode-warning {
    background: var(--warning-bg, #fff3cd);
    color: var(--warning-text, #856404);
}

[data-theme="dark"] .rcode-badge.rcode-warning {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
}

.rcode-badge.rcode-error {
    background: var(--danger-bg, #f8d7da);
    color: var(--danger-text, #721c24);
}

[data-theme="dark"] .rcode-badge.rcode-error {
    background: rgba(220, 53, 69, 0.2);
    color: #f87171;
}

.latency-total {
    font-weight: 500;
}

.latency-upstream {
    color: var(--text-secondary);
    font-size: 0.9em;
}

/* Time range buttons styling */
.time-range-buttons button {
    transition: all 0.2s ease;
}

.time-range-buttons button:hover {
    transform: translateY(-1px);
}

.time-range-buttons button:active {
    transform: translateY(0);
}

/* Mobile responsive adjustments */
@media (max-width: 1200px) {
    .upstream-cell {
        max-width: 120px;
    }

    .domain-cell {
        max-width: 180px;
    }
}

@media (max-width: 768px) {
    .queries-table th,
    .queries-table td {
        padding: 0.5rem 0.25rem;
        font-size: 0.85em;
    }

    .domain-cell {
        max-width: 150px;
    }

    .upstream-cell {
        display: none;
    }

    .queries-table thead th:nth-child(7) {
        display: none;
    }

    .queries-table tbody td:nth-child(7) {
        display: none;
    }

    .rcode-badge {
        padding: 0.2rem 0.4rem;
        font-size: 0.75em;
    }

    .time-range-buttons {
        justify-content: flex-start;
    }
}
</style>
