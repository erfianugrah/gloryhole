{{template "base.html" .}}

{{define "title"}}Dashboard - Gloryhole{{end}}

{{define "content"}}
<div class="dashboard">
    <div class="stats-header">
        <h2>Dashboard</h2>
        <div class="uptime">
            <span class="label">Uptime:</span>
            <span class="value">{{.Uptime}}</span>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div id="stats-container"
         hx-get="/api/ui/stats"
         hx-trigger="load, every 10s"
         hx-swap="morph"
         hx-ext="morph">
        <div class="stats-grid" aria-hidden="true">
            <div class="stat-card skeleton skeleton-card"></div>
            <div class="stat-card skeleton skeleton-card"></div>
            <div class="stat-card skeleton skeleton-card"></div>
            <div class="stat-card skeleton skeleton-card"></div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
        <h3>Traffic Trends</h3>
        <div class="charts-grid charts-grid-2">
            <div class="chart-card">
                <h4>Last Hour (per 5 min)</h4>
                <div class="chart-container">
                    <canvas id="queryChart" role="img" aria-label="Query traffic chart showing total, blocked, and cached queries over the last hour" aria-describedby="queryChart-legend"></canvas>
                </div>
                <div class="chart-legend" id="queryChart-legend" role="list" aria-label="Chart legend"></div>
            </div>
            <div class="chart-card">
                <h4>Cache Hit Rate</h4>
                <div class="chart-container">
                    <canvas id="cacheHitChart" role="img" aria-label="Cache hit rate percentage over time" aria-describedby="cacheHitChart-legend"></canvas>
                </div>
                <div class="chart-legend" id="cacheHitChart-legend" role="list" aria-label="Chart legend"></div>
            </div>
        </div>
    </div>

    <div class="charts-section">
        <h3>Distribution</h3>
        <div class="charts-grid charts-grid-3">
            <div class="chart-card">
                <div class="chart-card-header">
                    <h4>Query Type Distribution</h4>
                    <div class="chart-controls">
                        <label for="query-type-range">Range</label>
                        <select id="query-type-range" class="chart-range-select">
                            <option value="">All time</option>
                            <option value="1h">Last 1h</option>
                            <option value="6h">Last 6h</option>
                            <option value="24h">Last 24h</option>
                            <option value="168h">Last 7d</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="queryTypeChart" role="img" aria-label="Query type distribution showing breakdown of DNS query types" aria-describedby="queryTypeChart-legend"></canvas>
                </div>
                <div class="chart-legend" id="queryTypeChart-legend" role="list" aria-label="Chart legend"></div>
            </div>
            <div class="chart-card">
                <h4>Top Allowed Domains</h4>
                <div class="chart-container">
                    <canvas id="topAllowedChart" role="img" aria-label="Bar chart showing top allowed domains by query count" aria-describedby="topAllowedChart-legend"></canvas>
                </div>
                <div class="chart-legend" id="topAllowedChart-legend" role="list" aria-label="Chart legend"></div>
            </div>
            <div class="chart-card">
                <h4>Top Blocked Domains</h4>
                <div class="chart-container">
                    <canvas id="topBlockedChart" role="img" aria-label="Bar chart showing top blocked domains by query count" aria-describedby="topBlockedChart-legend"></canvas>
                </div>
                <div class="chart-legend" id="topBlockedChart-legend" role="list" aria-label="Chart legend"></div>
            </div>
        </div>
    </div>

    <!-- Top Domains -->
    <div class="top-domains-section">
        <div class="section-row">
            <div class="section-col">
                <h3>Top Allowed Domains</h3>
                <div id="top-allowed"
                     hx-get="/api/ui/top-domains?limit=10&blocked=false"
                     hx-trigger="load, every 20s"
                     hx-swap="innerHTML">
                    <div class="loading">Loading...</div>
                </div>
            </div>
            <div class="section-col blocked">
                <h3>Top Blocked Domains</h3>
                <div id="top-blocked"
                     hx-get="/api/ui/top-domains?limit=10&blocked=true"
                     hx-trigger="load, every 20s"
                     hx-swap="innerHTML">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Queries -->
    <div class="recent-queries-section">
        <h3>Recent Queries</h3>
        <div id="recent-queries"
             hx-get="/api/ui/queries?limit=20"
             hx-trigger="load, every 6s"
             hx-swap="innerHTML">
            <div class="loading">Loading queries...</div>
        </div>
    </div>
</div>

<script type="module" src="/static/js/dashboard-init.js"></script>
{{end}}
