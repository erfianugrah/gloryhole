# Test configuration for Glory Hole DNS server
server:
  listen_address: "127.0.0.1:5354" # Use port 5353 to avoid needing root
  udp_enabled: true
  tcp_enabled: true
  dot_enabled: false
  dot_address: ":853"
  enable_blocklist: true
  enable_policies: true
  decision_trace: true  # Enable for test visibility

  tls:
    cert_file: ""
    key_file: ""
    autocert:
      enabled: false
      hosts: []
      cache_dir: "./.cache/autocert"
      email: ""
      http01_address: ":80"
    acme:
      enabled: false
      dns_provider: "cloudflare"
      hosts: []
      upstream_dns_servers: []
      cache_dir: "./.cache/acme"
      email: ""
      renew_before: "720h"
      cloudflare:
        api_token: ""
        zone_id: ""
        ttl: 120
        propagation_timeout: "2m"
        polling_interval: "2s"
        skip_authoritative_check: false

upstream_dns_servers:
  - "10.0.10.2:53" # Cloudflare DNS

# Optional: blocklists for testing
blocklists: []

# Optional: whitelist for testing
whitelist: []

database:
  enabled: false
  backend: "sqlite"
  sqlite:
    path: "./glory-hole.test.db"

cache:
  enabled: true           # Enable DNS caching for better performance
  max_entries: 10000      # Maximum number of cached entries (LRU eviction)
  min_ttl: 60s            # Minimum TTL (prevent caching very short-lived records)
  max_ttl: 24h            # Maximum TTL (prevent caching stale records)
  negative_ttl: 5m        # TTL for upstream NXDOMAIN responses
  blocked_ttl: 1s         # TTL for blocked domain responses (reduces repeated blocking logic)
  shard_count: 0          # Cache sharding (0 = disabled, use for test consistency)

logging:
  level: "debug"     # Use debug level to see all queries
  format: "text"
  output: "stdout"
  add_source: true   # Enable for debugging - shows file:line for each log

telemetry:
  enabled: true
  service_name: "glory-hole-test"
  service_version: "dev"
  prometheus_enabled: true
  prometheus_port: 9090
  tracing_enabled: false
