# VyOS 1.4 Container Configuration for Glory-Hole
#
# To apply this configuration on VyOS:
# 1. Enter configuration mode: configure
# 2. Paste the container configuration below
# 3. Commit and save: commit; save
#
# Prerequisites:
# - Network 'podman-2' must exist
# - Create directory: /config/erfi/glory-hole/
# - Place config file: /config/erfi/glory-hole/config.yml

container {
    name glory-hole {
        cap-add "net-bind-service"
        environment TZ {
            value "Europe/Amsterdam"
        }
        host-name "glory-hole"
        image "erfianugrah/glory-hole:latest"
        memory "1024"
        network podman-2 {
            address "10.0.10.4"
        }
        port dns-udp {
            destination "53"
            protocol "udp"
            source "53"
        }
        port dns-tcp {
            destination "53"
            protocol "tcp"
            source "53"
        }
        port web-ui {
            destination "8080"
            protocol "tcp"
            source "8080"
        }
        port prometheus {
            destination "9090"
            protocol "tcp"
            source "9090"
        }
        restart "always"
        shared-memory "512"
        volume config {
            destination "/etc/glory-hole"
            mode "rw"
            source "/config/erfi/glory-hole/etc"
        }
        volume data {
            destination "/var/lib/glory-hole"
            mode "rw"
            source "/config/erfi/glory-hole/data"
        }
        volume logs {
            destination "/var/log/glory-hole"
            mode "rw"
            source "/config/erfi/glory-hole/logs"
        }
        volume localtime {
            destination "/etc/localtime"
            mode "ro"
            source "/etc/localtime"
        }
    }
}

# Directory structure to create on VyOS:
# /config/erfi/glory-hole/
# ├── etc/
# │   └── config.yml          (your config.personal.yml)
# ├── data/                   (database will be stored here)
# └── logs/                   (log files if file logging enabled)

# Setup commands for VyOS:
# mkdir -p /config/erfi/glory-hole/{etc,data,logs}
# cp config.personal.yml /config/erfi/glory-hole/etc/config.yml
# chown -R 1000:1000 /config/erfi/glory-hole
